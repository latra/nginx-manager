# PRUMINX - **PR**oxy **U**tility **M**anager for Ng**INX**

Tired of working with Docker and use a single nginx as a proxy for your domains?
Your colleague is broking the nginx config every time he/she adds a new service? **We are.**

## What is PRUMINX?
When the docker container referenced on the nginx config is not running, the nginx can crash due an error on the domain name resolution, breaking all the services served through nginx.

This webapp provides a simple way to configure nginx to be used as a proxy for different services when you use docker for your services, providing a simple Web UI to allow add and remove services, and handing them in 
different nginx configs.

Those registers are stored in a sqlite database, and the nginx configs are generated on the fly when you restart the nginx service, verifying that the registers are correctly defined and the containers are running, and disabling the specific routes if the container is not running to avoid nginx crashes.

This application is designed to work with a nginx container with certbot installed, so it can generate the certificates for the domains automatically. Is not directly possible to add custom certificates, but there are some approaches to do it.

## Requirements
- Nginx service should run in a docker container
- Docker Engine API should be accessible from a container
- Docker Engine > 27.4.0
- Docker Compose > 2.31.0

## How to use it
1. Clone the repository in your server
2. Configure the PRUMIX variables in the config.yaml file
3. Set up the .env file with the variables for the deployment:
- specify the PRUMIX API mapped port
- specify the API_URL environment variable to the server API and the PRUMIX specific port
```sh
SERVER_IP=127.0.0.1
PRUMIX_API_PORT=8000
PRUMIX_WEB_PORT=3001 
```

4. Modify the config.yaml file with the variables regarding the nginx and docker if needed:
```yaml
docker:
  # URL to access the docker engine API. host.docker.internal is the default docker host ip for containers running on the same machine.
  base_url: "http://host.docker.internal:2375"
  # Name of the docker network used by the nginx container to interconnect with the other containers.
  network: proxy-network

nginx:
  # ID of the nginx container.
  container_id: nginx

  # Path to the resources of the nginx container.
  # IMPORTANT: those paths must be relative to the nginx container! Not to to the host machine!
  static_path: /config/
  private_key_path: /etc/nginx/ssl/private.key
  certificate_path: /etc/nginx/ssl/certificate.crt
  letsencrypt_path: /etc/letsencrypt/live/
  docker_config_file: dockers.conf

  # Paths the different files used by the nginx container.
  # IMPORTANT: this path is relative to the backend container! Not to to the host machine
  config_path: /app/nginx_conf/


  # Warning message for users to avoid editing the docker config file.
  config_warn_message: "#IMPORTANT IMPORTANT IMPORTANT\n# Please, do not edit this file. Use the webpage to connect your container!\n#-----------------------------------------------------------------------------------------------------"
```
5. Run the docker-compose.yaml file
```sh
docker compose up -d
```

## Usage
A webpage will be available at the specified port in the .env file, by default `http://localhost:3001/`.



